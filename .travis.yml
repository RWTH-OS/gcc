sudo: required
dist: trusty
git:
  submodules: false
language: c
compiler: gcc
before_install:
- sudo apt-get -qq update
- sudo apt-get install -y nasm texinfo libmpfr-dev libmpc-dev libgmp-dev libisl-dev
  packaging-dev
script:
- rm -rf .git
- cd ..
- mv gcc gcc-5.3.1
- tar czf gcc_5.3.1.orig.tar.gz gcc-5.3.1
- cd $TOPDIR
- wget https://bintray.com/rwth-os/hermitcore/download_file?file_path=binutils-hermit_2.26.1-1_amd64.deb -O binutils-hermit_2.26.1-1_amd64.deb
- sudo dpkg -i ./binutils-hermit_2.26.1-1_amd64.deb
- wget https://bintray.com/rwth-os/hermitcore/download_file?file_path=newlib-hermit_2.4.0-1_amd64.deb -O newlib-hermit_2.4.0-1_amd64.deb
- sudo dpkg -i ./newlib-hermit_2.4.0-1_amd64.deb
- wget https://bintray.com/rwth-os/hermitcore/download_file?file_path=pthread-embedded-hermit_1.0-1_amd64.deb -O pthread-embedded-hermit_1.0-1_amd64.deb
- sudo dpkg -i ./pthread-embedded-hermit_1.0-1_amd64.deb
- wget https://www.lankes.org/deploy/bootstrap.tar.gz
- tar xzf bootstrap.tar.gz
- mkdir -p $TOPDIR/tmp/bootstrap
- cd $TOPDIR/tmp/bootstrap
- $TOPDIR/RWTH-OS/gcc-5.3.1/configure --target=x86_64-hermit --prefix=/opt/hermit --without-headers --with-newlib --with-isl --disable-multilib --with-tune=generic --enable-languages=c,c++,lto --disable-nls --disable-shared --disable-libssp --enable-threads=posix --disable-libgomp --enable-tls --enable-lto --disable-symvers
- make -j2
- sudo make install
- cd $TOPDIR/RWTH-OS/gcc-5.3.1
- debuild -us -uc
env:
   global:
     - TOPDIR=/home/travis/build
     - PATH=$PATH:/opt/hermit/bin/:$TOPDIR/x86/bin
     - CROSSCOMPREFIX = x86_64-hermit
     - STACKPROT = -fno-stack-protector
     - FC_FOR_TARGET = $CROSSCOMPREFIX-gfortran
     - CC_FOR_TARGET = $CROSSCOMPREFIX-gcc
     - CXX_FOR_TARGET = $CROSSCOMPREFIX-g++
     - GCC_FOR_TARGET = $CROSSCOMPREFIX-gcc
     - CPP_FOR_TARGET = $CROSSCOMPREFIX-cpp
     - AR_FOR_TARGET = $CROSSCOMPREFIX-ar
     - AS_FOR_TARGET = $CROSSCOMPREFIX-as
     - LD_FOR_TARGET = $CROSSCOMPREFIX-ld
     - NM_FOR_TARGET = $CROSSCOMPREFIX-nm
     - OBJDUMP_FOR_TARGET = $CROSSCOMPREFIX-objdump
     - OBJCOPY_FOR_TARGET = $CROSSCOMPREFIX-objcopy
     - RANLIB_FOR_TARGET = $CROSSCOMPREFIX-ranlib
     - STRIP_FOR_TARGET = $CROSSCOMPREFIX-strip
     - READELF_FOR_TARGET = $CROSSCOMPREFIX-readelf
     - ELFEDIT_FOR_TARGET = $CROSSCOMPREFIX-elfedit
     - CFLAGS_FOR_TARGET = -m64 -mtls-direct-seg-refs -O3 -ftree-vectorize $STACKPROT
     - FCFLAGS_FOR_TARGET = -m64 -mtls-direct-seg-refs -O3 -ftree-vectorize
     - FFLAGS_FOR_TARGET = -m64 -mtls-direct-seg-refs -O3 -ftree-vectorize
     - CXXFLAGS_FOR_TARGET = -m64 -mtls-direct-seg-refs -O3 -ftree-vectorize
